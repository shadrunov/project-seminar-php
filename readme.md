# отчёт 5.1 Приложение с базой данных
Шадрунов Алексей, БИБ202

# Работа API

## login.php
![image](https://user-images.githubusercontent.com/44522467/161385386-f4b6f649-dc4d-4249-b0a6-7cfd316a9e55.png)  

проходим авторизацию методом post, чтобы пароль не передавался в открытом виде в адресной строке и в логах серверов.  
при авторизации создаётся сессия. в бд хранятся хэши паролей, а не сами пароли.  


## listitems.php 

метод get  

отображает записи из бд с помощью шаблонов. вывод экранируется. есть кнопки просмотр, редактировать и удалить запись. сверху есть меню с пунктами отобразить элементы, выйти из сессии, а также написано имя текущего пользователя.  

можно фильтровать как угодно по имени, городу или департаменту. город и департамент надо выбирать из раскрывающегося списка. можно указывать сколько строк показывать на странице (пагинация).

![image](https://user-images.githubusercontent.com/44522467/161385462-d41b71cc-9240-48a4-97fa-ca693d54f79e.png)


## getitem.php  

метод get  

при нажатии на кнопку просмотра открывается эта форма. здесь в таблице указываются все поля, а также связанные м-м сущности (курсы). отсюда можно перейти к редактированию и удалению записи.  
![image](https://user-images.githubusercontent.com/44522467/161385598-e59fdd87-66fe-454b-979c-5db8047f9fd6.png)


## additem.php  

метод post  

если нажать на кнопку сверху, можно добавить запись. после добавления переходим к странице просмотра. 

![image](https://user-images.githubusercontent.com/44522467/161385696-0f141cee-9d1d-45b5-9abc-9c5724213c43.png)
![image](https://user-images.githubusercontent.com/44522467/161385704-9c801e39-9eb8-4a4b-9051-4cb095b2f89c.png)


## edititem.php
если нажать на кнопку редактировать, откроется форма редактирования. в ней подставлены предыдущие значения. при редактировании можно изменить значения, и они отобразятся после нажатия кнопки

![image](https://user-images.githubusercontent.com/44522467/161385771-7c53b274-f769-4b3c-bf17-dc0ffa4582c3.png)
![image](https://user-images.githubusercontent.com/44522467/161385779-b0e9319f-f0bc-41f5-9e33-0d9826fa86a9.png)



## deleteitem.php
можно удалить запись, не связанную с курсами. для этого надо нажать на кнопку удалить. после успешного удаления отобразится список всех элементов. если нажать на кнопку нет, вернёмся назад.  

![image](https://user-images.githubusercontent.com/44522467/161385838-612c2c41-8c03-49f7-9d21-ba949777c5fb.png)
![image](https://user-images.githubusercontent.com/44522467/161385896-daa87b2e-e5e5-493a-ad0f-b53add3ca777.png)

## logout.php
можно нажать на кнопку выйти. сессия завершится

![image](https://user-images.githubusercontent.com/44522467/161386018-8e5ab4b4-6020-4977-840c-845c22d7c378.png)
![image](https://user-images.githubusercontent.com/44522467/161386022-4fd7577f-1328-4544-b412-0f1d15c5c3e0.png)


- **бонус**: сообщения об ошибках логируются в [error.log](./template1/error.log)
![image](https://user-images.githubusercontent.com/44522467/150424089-15cd9d89-4ab4-4bd2-b501-3861aeb0273d.png)  
- **бонус**: сообщения об ошибках безопасности логгируются в [security.log](./template1/error.log)
![image](https://user-images.githubusercontent.com/44522467/161386078-0868bbc5-e711-48ef-9b22-24a30cb262c0.png)

# работа с БД
- все данные экранируются с помощью prepare execute
- используется `left join`
- используется таблица М-М
- сгенерировано большое количество записей
дамп базы данных: [dump.sql](./dump.sql)

# обработка ошибок
все ошибки обрабатываются, выводятся сообшения пользователю
![image](https://user-images.githubusercontent.com/44522467/161386119-579e85d2-f62e-489d-a047-e22d13874640.png) 
![image](https://user-images.githubusercontent.com/44522467/161386199-23b14392-50e4-46b3-8e1a-cf91c58a75e4.png)

логируется в журнал

# безопасность
все функции доступны только после авторизации, ни один запрос не будет выполнен, если пользователь не присылает правильную куку. куки защищены всеми нужными свойствами, как в прошлой работе. 

# шаблонизатор
используется шаблонизатор twig, вывод экранируется, xss не проходит