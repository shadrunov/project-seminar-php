**Федеральное государственное автономное образовательное учреждение высшего образования «НАЦИОНАЛЬНЫЙ ИССЛЕДОВАТЕЛЬСКИЙ УНИВЕРСИТЕТ «ВЫСШАЯ ШКОЛА ЭКОНОМИКИ»**  
**Московский институт электроники и математики им. Тихонова**  
**Департамент электронной инженерии**  

### Лабораторная работа №9 по курсу
### «Проектный семинар»
# «Итоговое приложение на классах»

**Выполнил: Студент группы БИБ202 Шадрунов Алексей**  
**Преподаватель: Башун В. В.**  
Дата выполнения: 22 июня 2022 г.  
Москва, 2022

---


# Работа API

## login
```
GET /index.php?page=login
```
![image](https://user-images.githubusercontent.com/44522467/175136232-fa0d73c5-aa6d-4576-aeeb-60cebc1a08d4.png)  
*Рисунок 1 -- Форма входа*  

проходим авторизацию методом `post`, чтобы пароль не передавался в открытом виде в адресной строке и в логах серверов.  
при авторизации создаётся сессия. в бд хранятся **хэши паролей**, а не сами пароли.  

```
POST /index.php?page=login
```
![image](https://user-images.githubusercontent.com/44522467/175136805-d2eab07a-3ce7-4e54-bcab-9c4d75d3d6fa.png)
*Рисунок 2 -- Успешный вход перенаправляет на list items*  


## list items
```
GET /index.php?page=login
```
![image](https://user-images.githubusercontent.com/44522467/175137201-8550dc50-4a93-4f33-bd11-59e0f0614e29.png)
*Рисунок 3 -- list items*  

метод get  

отображает записи из бд с помощью шаблонов. вывод экранируется. есть кнопки просмотр, редактировать и удалить запись. сверху есть меню с пунктами отобразить элементы, выйти из сессии, а также написано имя текущего пользователя.  

можно фильтровать как угодно по имени, городу или департаменту. город и департамент надо выбирать из раскрывающегося списка. можно указывать сколько строк показывать на странице (пагинация).

![image](https://user-images.githubusercontent.com/44522467/175139314-1460fa34-bbf7-4d36-a146-4a64f9bc7bdd.png)
*Рисунок 4 -- применение фильтров*  



## get item
```
GET /index.php?page=item&ID=<record_id>
```  
метод get  

при нажатии на кнопку просмотра открывается эта форма. здесь в таблице указываются все поля, а также связанные м-м сущности (курсы). отсюда можно перейти к редактированию и удалению записи.  
![image](https://user-images.githubusercontent.com/44522467/175140361-513d3c37-3a2b-46dd-a1a8-c3523b05d906.png)
*Рисунок 5 -- просмотр записи*  


## edit item
```
GET /index.php?page=item&action=edit&ID=<record_id>
```  
метод get  

если нажать на кнопку редактировать, откроется форма редактирования. в ней подставлены предыдущие значения. при редактировании можно изменить значения, и они отобразятся после нажатия кнопки
![image](https://user-images.githubusercontent.com/44522467/175141269-37fe17f8-3e77-4b73-b83e-7f9717f233ea.png)
*Рисунок 6 -- форма на редактирование*  

![image](https://user-images.githubusercontent.com/44522467/175142178-95c60f03-2c47-41fe-83fd-9a8a91befd2a.png)
*Рисунок 7 -- после отправки формы происходит редиркет на просмотр*  


## delete item
```
GET /index.php?page=item&action=delete&ID=518
```  
можно удалить запись, не связанную с курсами. для этого надо нажать на кнопку удалить. после успешного удаления отобразится список всех элементов. если нажать на кнопку нет, вернёмся назад к просмотру элемента.  

![image](https://user-images.githubusercontent.com/44522467/175142436-2337761f-cbd3-4279-bf6a-cd6279f652b9.png)
*Рисунок 8 -- форма подтверждения удаления*  

```
POST /index.php?page=item&action=delete&ID=518
```  
![image](https://user-images.githubusercontent.com/44522467/175142974-d68d7539-3448-4818-915c-978b9f36dd4b.png)
*Рисунок 9 -- удалено*  
после удаления произошёл редирект к списку записей.   


## add item  
```
GET /index.php?page=item&action=add
```  
метод get

отображается форма, куда нужно вписать параметры новой записи.

![image](https://user-images.githubusercontent.com/44522467/175143584-b87e5ca0-19f0-437d-a72c-ac9c86282e25.png)
*Рисунок 10 -- форма добавления*  

```
POST /index.php?page=item&action=add
```  
если нажать на кнопку сверху, можно добавить запись. после добавления переходим к странице просмотра. 

![image](https://user-images.githubusercontent.com/44522467/175143966-539c6597-0548-42cd-a56b-50632e04f662.png)
*Рисунок 11 -- редирект на новую запись после добавления*  



## logout
```
GET /index.php?page=logout
```  
метод get

отображается форма для выхода.

![image](https://user-images.githubusercontent.com/44522467/175144417-79fa5d38-bef9-48d4-95a4-04396d9dca09.png)
*Рисунок 12 -- форма выхода*  

```
POST /index.php?page=logout
```  
можно нажать на кнопку выйти. сессия завершится.  
![image](https://user-images.githubusercontent.com/44522467/175144546-30437854-886c-4739-ae9f-3e8aa3e17b03.png)
*Рисунок 13 -- выход успешен*  



# классы
всё приложение работает на классах. используется один index.php. используется автозагрузка классов. используется пространства имён.  

классы:  
- DBClass
- ItemClass
- LoginClass
- LogoutClass  

в каждом классе роутер сопоставляет нужные методы нужным запросам. повторяющаяся логика вынесена в базовый класс.

# loggers
используется класс файловых логгеров, два логгера: один для сообщений безопасности, другой для информационных сообщений.


![image](https://user-images.githubusercontent.com/44522467/175145191-e4566bda-7200-4867-8e2f-38525fabf1b4.png)
*Рисунок 14 -- сообщения об ошибках логируются в error.log*  

![image](https://user-images.githubusercontent.com/44522467/175145256-4ca2bfec-d67c-421b-a5a8-17a342f2da38.png)
*Рисунок 15 -- сообщения об ошибках безопасности логгируются в security.log*  
 


# работа с БД
- все данные экранируются с помощью prepare execute
- используется `left join`
- используется таблица М-М
- сгенерировано большое количество записей
дамп базы данных: [dump.sql](./dump.sql)

# обработка ошибок
все ошибки обрабатываются, выводятся сообшения пользователю
![image](https://user-images.githubusercontent.com/44522467/161386119-579e85d2-f62e-489d-a047-e22d13874640.png) 
![image](https://user-images.githubusercontent.com/44522467/161386199-23b14392-50e4-46b3-8e1a-cf91c58a75e4.png)

логируется в журнал

# безопасность
все функции доступны только после авторизации, ни один запрос не будет выполнен, если пользователь не присылает правильную куку. куки защищены всеми нужными свойствами, как в прошлой работе. 

# шаблонизатор
используется шаблонизатор twig, вывод экранируется, xss не проходит